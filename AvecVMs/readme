ğŸ› ï¸ Script update-proxmox_VMs.sh
ğŸ“‹ Description
Ce script Bash permet de mettre Ã  jour automatiquement :

Le nÅ“ud Proxmox VE
Les conteneurs LXC (sauf ceux explicitement ignorÃ©s)
Les machines virtuelles (VMs) via SSH
Il gÃ©nÃ¨re un rapport de mise Ã  jour, lâ€™envoie par email avec les logs en piÃ¨ce jointe, et envoie Ã©galement une notification Telegram.

âš™ï¸ PrÃ©requis
Proxmox VE avec accÃ¨s root
Outils installÃ©s :
mailx
curl
sshpass
jq
AccÃ¨s SSH root aux VMs
Un bot Telegram configurÃ©
Un compte email SMTP (ex : Gmail)
ğŸ§¾ Installation
Copier le script dans /usr/local/bin/update-proxmox_VMs.sh
Rendre le script exÃ©cutable :

Adapter les variables de configuration en haut du script :
ROOT_USER, ROOT_PASS
SMTP_* pour lâ€™envoi dâ€™email
TELEGRAM_TOKEN, TELEGRAM_CHAT_ID
IGNORED_CONTAINERS pour exclure certains CTs
ğŸš€ Utilisation
ExÃ©cuter le script avec les droits root :


ğŸ“¦ FonctionnalitÃ©s
ğŸ”„ Mise Ã  jour du systÃ¨me hÃ´te (apt update && upgrade)
ğŸ“¦ Mise Ã  jour des conteneurs LXC actifs
ğŸ’» Mise Ã  jour des VMs via SSH (si IP dÃ©tectÃ©e et port SSH ouvert)
ğŸ“§ Envoi dâ€™un email avec le rÃ©sumÃ© et les logs
ğŸ“² Notification Telegram avec le rÃ©sumÃ©
ğŸ—ƒï¸ Rotation automatique des logs (suppression aprÃ¨s 7 jours)
ğŸ“ Logs
Les logs sont stockÃ©s dans : /var/log/proxmox-update/update.log
Les anciens logs sont archivÃ©s dans : /var/log/proxmox-update/archive/
ğŸ›¡ï¸ SÃ©curitÃ©
Le mot de passe root est stockÃ© en clair dans le script. Il est fortement recommandÃ© dâ€™utiliser une mÃ©thode plus sÃ©curisÃ©e (clÃ© SSH, vault, etc.) en production.
