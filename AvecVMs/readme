# ğŸ› ï¸ Script de Mise Ã  Jour Proxmox : `update-proxmox.sh`

## ğŸ“Œ Objectif

Ce script automatise la mise Ã  jour :
- Du **nÅ“ud Proxmox VE**
- Des **conteneurs LXC**
- Des **machines virtuelles (VMs)** via SSH

Il envoie ensuite un **rapport par email** (avec logs) et une **notification Telegram**.

---

## âš™ï¸ FonctionnalitÃ©s

- Mise Ã  jour silencieuse du systÃ¨me (`apt update && apt upgrade`) sans interaction
- DÃ©tection automatique des VMs et LXC actifs
- Mise Ã  jour via SSH des VMs (si IP accessible)
- Rotation automatique des logs (7 jours)
- Notification par :
  - ğŸ“§ Email (via SMTP avec `s-nail`)
  - ğŸ“² Telegram (via bot API)

---

## âœ… PrÃ©requis

### Paquets nÃ©cessaires :
```bash
sudo apt install s-nail curl jq sshpass netcat
```

### AccÃ¨s :
- Root sur le nÅ“ud Proxmox
- AccÃ¨s root par mot de passe SSH Ã  chaque VM

---

## ğŸ” Configuration Ã  adapter dans le script

```bash
ROOT_USER="root"
ROOT_PASS="votre_mot_de_passe_root"
SSH_PORT=22

SMTP_SERVER="smtp.gmail.com"
SMTP_USER="votre.email@gmail.com"
SMTP_PASS="mot_de_passe_application"
EMAIL_TO="votre.email@gmail.com"

TELEGRAM_TOKEN="123456789:ABC...XYZ"
TELEGRAM_CHAT_ID="12345678"
```

---

## ğŸ“¤ Exemple d'envoi d'email

Le script utilise `s-nail` avec des options SMTP sÃ©curisÃ©es.  
Si ton systÃ¨me utilise `mailx` BSD, **tu dois installer `s-nail`**.

```bash
sudo apt install s-nail
```

---

## ğŸ•’ Planification avec `cron`

Ajoute Ã  la crontab (`sudo crontab -e`) pour une exÃ©cution hebdomadaire :

```cron
0 4 * * 0 /usr/local/bin/update-proxmox.sh >> /var/log/proxmox-update/cron.log 2>&1
```

---

## ğŸ”„ RÃ©sultat de sortie

Le script gÃ©nÃ¨re un rÃ©sumÃ© :

```
RÃ©sumÃ© de la mise Ã  jour Proxmox :
- Conteneurs mis Ã  jour : 3
- Conteneurs ignorÃ©s : 1
- Conteneurs non dÃ©marrÃ©s : 2
- VMs mises Ã  jour : 4
```

Et envoie :
- Un **email** avec le log en piÃ¨ce jointe
- Une **notification Telegram** contenant ce rÃ©sumÃ©

---

## ğŸ›¡ï¸ SÃ©curitÃ©

- Le mot de passe root est stockÃ© en clair dans le script
  - ğŸ”’ Il est recommandÃ© d'utiliser un `.env` ou un `vault`
  - ğŸ” Tu peux aussi migrer vers une **authentification par clÃ© SSH**

---

## ğŸ“ Emplacement recommandÃ©

```bash
sudo cp update-proxmox.sh /usr/local/bin/update-proxmox.sh
sudo chmod +x /usr/local/bin/update-proxmox.sh
```

---

## ğŸ§‘â€ğŸ’» Auteur

- Nom : RTO54
- Date : Juillet 2025
- Licence : Libre usage privÃ©

---
